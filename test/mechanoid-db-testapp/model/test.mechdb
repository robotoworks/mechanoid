package com.mechanoid.db

database TestDB {
	migration {
		create table table_a ( 
			_id integer primary key autoincrement
		);
		
		create view qux as 
			select *, 
			a as a,b as b,c as c,d as d,
				count(_id, a, c) as y,
				(case when a is null then b else null end) from table_a as a
				left join c on a=b or a=c and (b=c)
				group by a,b,c=0
			union
				select a from qux
			union
				select meh from y
			order by x desc;
		
		create view meh as
			select null as _id,
			       _id as product_id,
			       title as title,
			       null as quantity
			  from products as p
			union
			select li._id as _id,
			       product_id,
			       null as title,
			       1 as quantity
			  from line_items as li
			 where is_complex = 1
			union
			select li._id as _id,
			       product_id,
			       null as title,
			       count( * ) as quantity
			  from line_items as li
			 where is_complex = 0
			 group by product_id
			 order by product_id, _id;
	}
}